<div
  class="min-h-screen bg-gray-900 text-white font-sans relative flex flex-col"
  [ngClass]="{
    'print-a4': printSize === 'A4',
    'print-letter': printSize === 'Letter',
    'print-portrait': printOrientation === 'portrait',
    'print-landscape': printOrientation === 'landscape',
  }"
>
  <!-- Background Image -->
  <div class="fixed inset-0 h-screen w-screen z-0 pointer-events-none print:hidden">
    <picture>
      <source srcset="assets/images/bauernhof-portrait-dunkel.webp" media="(orientation: portrait)" />
      <img src="assets/images/bauernhof-landscape-dunkel.webp" alt="" fetchpriority="high" class="w-full h-full object-cover portrait:object-center landscape:object-center" />
    </picture>
  </div>

  <!-- Navigation Bar -->
  <nav
    class="bg-gray-900/95 border-b border-gray-700 backdrop-blur shadow-lg px-6 py-1 fixed top-0 left-0 right-0 z-50 flex items-center justify-between shrink-0 h-10 print:hidden"
  >
    <div class="flex items-center gap-4">
      <h1 class="text-xl font-bold font-sans text-emerald-500 tracking-wider">SOIL</h1>
    </div>

    <div class="flex items-center gap-3">
      <button
        (click)="showPrintModal = true"
        class="p-2 hover:bg-gray-800 rounded-lg text-gray-400 hover:text-white transition w-10 h-10 flex items-center justify-center"
        [title]="t('manual.print')"
      >
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"
          />
        </svg>
      </button>

      @defer (hydrate on interaction) {
      }

      <a
        routerLink="/"
        class="p-2 hover:bg-gray-800 rounded-lg text-gray-400 hover:text-white transition w-10 h-10 flex items-center justify-center"
        title="Back to Landing Page"

      >
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"
          />
        </svg>
      </a>
    </div>
  </nav>

  <div class="relative z-10 max-w-5xl mx-auto px-4 sm:px-6 pt-[72px] pb-12 portrait:px-0 portrait:max-w-none flex flex-col gap-8">
    <header
      class="order-1 text-center bg-gray-900/80 backdrop-blur-md p-8 sm:p-12 rounded-3xl border border-gray-700 shadow-2xl portrait:rounded-none portrait:border-x-0 relative"
    >
      <h1 class="text-4xl sm:text-6xl font-black text-white mb-4 tracking-tight">
        {{ t('manual.title') }}
      </h1>
      <p class="text-xl text-white max-w-2xl mx-auto">{{ t('manual.subtitle') }}</p>
    </header>

    <!-- Table of Contents -->
    <aside
      class="order-2 w-full min-[1400px]:w-52 min-[1400px]:absolute min-[1400px]:left-full min-[1400px]:ml-2 min-[1400px]:top-[72px] min-[1400px]:h-full min-[1400px]:order-none print:hidden shrink-0 z-40 portrait:border-x-0"
    >
      <div class="min-[1400px]:sticky min-[1400px]:top-12 bg-gray-900/80 backdrop-blur-md p-6 rounded-3xl border border-gray-700 shadow-xl h-fit portrait:rounded-none portrait:border-x-0">
        <h2 class="text-xl font-bold text-emerald-400 mb-4 flex items-center gap-2">
          <span>üìã</span>
          {{ t('manual.toc.title') }}
        </h2>
        <nav class="flex flex-col gap-2">
          <a
            routerLink="."
            fragment="intro"
            class="text-white hover:text-white hover:bg-white/5 px-3 py-2 rounded-xl transition flex items-center gap-2"
          >
            <span class="text-sm">üìñ</span>
            {{ t('manual.intro.title') }}
          </a>
          <a
            routerLink="."
            fragment="concepts"
            class="text-white hover:text-white hover:bg-white/5 px-3 py-2 rounded-xl transition flex items-center gap-2"
          >
            <span class="text-sm">üí°</span>
            {{ t('manual.concepts.title') }}
          </a>
          <a
            routerLink="."
            fragment="crops"
            class="text-white hover:text-white hover:bg-white/5 px-3 py-2 rounded-xl transition flex items-center gap-2"
          >
            <span class="text-sm">üåæ</span>
            {{ t('manual.crops.title') }}
          </a>
          <a
            routerLink="."
            fragment="husbandry"
            class="text-white hover:text-white hover:bg-white/5 px-3 py-2 rounded-xl transition flex items-center gap-2"
          >
            <span class="text-sm">üêñ</span>
            {{ t('manual.husbandry.title') }}
          </a>
          <div class="ml-4 flex flex-col gap-1 mt-1 border-l border-gray-800">
            @for (crop of crops; track crop.id) {
              <a
                routerLink="."
                [fragment]="crop.id.toLowerCase()"
                class="text-sm text-white hover:text-emerald-400 px-3 py-1 transition"
              >
                {{ crop.name }}
              </a>
            }
          </div>
        </nav>
      </div>
    </aside>

    <div class="order-3 relative flex flex-col gap-8">
      <!-- Main Content -->
      <div class="flex-1 flex flex-col gap-8 w-full min-w-0">
        <!-- General Section -->
        <section
          id="intro"
          class="bg-gray-900/80 backdrop-blur-md p-8 sm:p-12 rounded-3xl border border-gray-700 shadow-2xl scroll-mt-24 print-page-break-after print:bg-white print:border-gray-200 print:shadow-none print:m-0 print:mb-8 portrait:rounded-none portrait:border-x-0"
        >
          <h2 class="text-3xl font-bold text-emerald-400 mb-8 flex items-center gap-3 print:text-emerald-700">
            <span class="bg-emerald-900/50 p-2 rounded-xl text-2xl print:bg-emerald-100">üìñ</span>
            {{ t('manual.intro.title') }}
          </h2>
          <div class="grid md:grid-cols-2 gap-12 text-white leading-relaxed print:text-gray-700">
            <div>
              <h3 class="text-xl font-bold text-white mb-4 print:text-black">{{ t('manual.intro.goal.title') }}</h3>
              <p>{{ t('manual.intro.goal.text') }}</p>
            </div>
            <div>
              <h3 class="text-xl font-bold text-white mb-4 print:text-black">
                {{ t('manual.intro.mechanics.title') }}
              </h3>
              <p>{{ t('manual.intro.mechanics.text') }}</p>
            </div>
          </div>
        </section>

        <!-- Concepts Section -->
        <section
          id="concepts"
          class="bg-gray-900/80 backdrop-blur-md p-8 sm:p-12 rounded-3xl border border-gray-700 shadow-2xl scroll-mt-24 print-page-break-after print:bg-white print:border-gray-200 print:shadow-none print:m-0 print:mb-8 portrait:rounded-none portrait:border-x-0"
        >
          <h2 class="text-3xl font-bold text-emerald-400 mb-8 flex items-center gap-3 print:text-emerald-700">
            <span class="bg-emerald-900/50 p-2 rounded-xl text-2xl print:bg-emerald-100">üí°</span>
            {{ t('manual.concepts.title') }}
          </h2>
          <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8 portrait:gap-8 portrait:divide-y-0">
            @for (
              concept of ['units', 'pest', 'rotation', 'requirements', 'weather', 'yield', 'price', 'machines', 'bio'];
              track concept;
              let i = $index
            ) {
              @defer (hydrate on viewport) {
                <app-manual-concept-card [concept]="concept" [index]="i"></app-manual-concept-card>
              }
            }
          </div>
        </section>

        <!-- Husbandry Section -->
        <section
          id="husbandry"
          class="bg-gray-900/80 backdrop-blur-md p-8 sm:p-12 rounded-3xl border border-gray-700 shadow-2xl scroll-mt-24 print-page-break-after print:bg-white print:border-gray-200 print:shadow-none print:m-0 print:mb-8 portrait:rounded-none portrait:border-x-0"
        >
          <h2 class="text-3xl font-bold text-emerald-400 mb-8 flex items-center gap-3 print:text-emerald-700">
            <span class="bg-emerald-900/50 p-2 rounded-xl text-2xl print:bg-emerald-100">üêñ</span>
            {{ t('manual.husbandry.title') }}
          </h2>
          <div class="flex flex-col gap-12 sm:gap-20 leading-relaxed text-white print:text-gray-700">
            <p>{{ t('manual.husbandry.text') }}</p>
            @for (crop of husbandryCrops; track crop.id) {
              <div class="flex flex-col gap-12 sm:gap-20">
                @defer (hydrate on viewport) {
                  <app-manual-crop-card [id]="crop.id.toLowerCase()" [crop]="crop"></app-manual-crop-card>
                }
              </div>
            }
          </div>
        </section>

        <!-- Crops Section -->
        <section
          id="crops"
          class="bg-gray-900/80 backdrop-blur-md p-8 sm:p-12 rounded-3xl border border-gray-700 shadow-2xl scroll-mt-24 print:bg-white print:border-gray-200 print:shadow-none print:m-0 print:mb-8 portrait:rounded-none portrait:border-x-0"
        >
          <h2 class="text-3xl font-bold text-emerald-400 mb-8 flex items-center gap-3 print:text-emerald-700">
            <span class="bg-emerald-900/50 p-2 rounded-xl text-2xl print:bg-emerald-100">üåæ</span>
            {{ t('manual.crops.title') }}
          </h2>
          <div class="flex flex-col gap-12 sm:gap-20">
            @for (crop of crops; track crop.id) {
              <div class="flex flex-col gap-12 sm:gap-20">
                @defer (hydrate on viewport) {
                  <app-manual-crop-card [id]="crop.id.toLowerCase()" [crop]="crop"></app-manual-crop-card>
                }
                @if (!$last) {
                  <div class="h-px bg-gradient-to-r from-transparent via-gray-700 to-transparent"></div>
                }
              </div>
            }
          </div>
        </section>
      </div>
    </div>
  </div>

  <!-- Print Settings Modal -->
  @if (showPrintModal) {
    <app-manual-print-modal
      [printSize]="printSize"
      [printOrientation]="printOrientation"
      (cancelPrint)="showPrintModal = false"
      (print)="print()"
      (sizeChange)="printSize = $event"
      (orientationChange)="printOrientation = $event"
    ></app-manual-print-modal>
  }
</div>
