<div
  class="min-h-screen bg-gray-900 text-white font-sans relative flex flex-col overflow-x-hidden"
  [ngClass]="{
    'print-a4': printSize === 'A4',
    'print-letter': printSize === 'Letter',
    'print-portrait': printOrientation === 'portrait',
    'print-landscape': printOrientation === 'landscape',
  }"
>
  <!-- Background Image -->
  <div class="fixed inset-0 z-0 opacity-40 pointer-events-none print:hidden">
    <picture>
      <source srcset="assets/bauernhof-portrait-hd.webp" media="(orientation: portrait)" />
      <img src="assets/bauernhof-landscape-hd.webp" alt="Farm background" class="w-full h-full object-cover portrait:object-center landscape:object-center" />
    </picture>
  </div>

  <!-- Navigation Bar -->
  <nav
    class="bg-gray-900/95 border-b border-gray-700 backdrop-blur shadow-lg px-6 py-1 sticky top-0 z-50 flex items-center justify-between shrink-0 h-10 print:hidden"
  >
    <div class="flex items-center gap-4">
      <h1 class="text-xl font-bold font-serif text-emerald-500 tracking-wider">SOIL MANUAL</h1>
    </div>

    <div class="flex items-center gap-3">
      @defer (hydrate on interaction) {
        <app-language-switcher></app-language-switcher>
      }

      <a
        routerLink="/"
        class="p-2 hover:bg-gray-800 rounded-lg text-gray-400 hover:text-white transition"
        title="Back to Landing Page"
        i18n-title="Action Label|Tooltip to go back to landing page@@nav.backToLanding"
      >
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"
          />
        </svg>
      </a>
    </div>
  </nav>

  <div class="relative z-10 max-w-5xl mx-auto px-4 sm:px-6 py-12 portrait:px-0 portrait:max-w-none flex flex-col gap-8">
    <header
      class="text-center bg-gray-900/80 backdrop-blur-md p-8 sm:p-12 rounded-3xl border border-gray-700 shadow-2xl portrait:rounded-none portrait:border-x-0 relative"
    >
      <button
        (click)="showPrintModal = true"
        class="absolute top-8 right-8 px-4 py-2 bg-emerald-600 hover:bg-emerald-500 text-white font-bold rounded-lg border border-emerald-500 transition text-sm flex items-center gap-2 print:hidden"
      >
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"
          />
        </svg>
        {{ t('manual.print') }}
      </button>

      <h1 class="text-4xl sm:text-6xl font-black text-white mb-4 tracking-tight">
        {{ t('manual.title') }}
      </h1>
      <p class="text-xl text-gray-400 max-w-2xl mx-auto">{{ t('manual.subtitle') }}</p>
    </header>

    <!-- General Section -->
    <section
      class="bg-gray-900/80 backdrop-blur-md p-8 sm:p-12 rounded-3xl border border-gray-700 shadow-2xl print-page-break-after print:bg-white print:border-gray-200 print:shadow-none print:m-0 print:mb-8 portrait:rounded-none portrait:border-x-0"
    >
      <h2 class="text-3xl font-bold text-emerald-400 mb-8 flex items-center gap-3 print:text-emerald-700">
        <span class="bg-emerald-900/50 p-2 rounded-xl text-2xl print:bg-emerald-100">üìñ</span>
        {{ t('manual.intro.title') }}
      </h2>
      <div class="grid md:grid-cols-2 gap-12 text-gray-300 leading-relaxed print:text-gray-700">
        <div>
          <h3 class="text-xl font-bold text-white mb-4 print:text-black">{{ t('manual.intro.goal.title') }}</h3>
          <p>{{ t('manual.intro.goal.text') }}</p>
        </div>
        <div>
          <h3 class="text-xl font-bold text-white mb-4 print:text-black">
            {{ t('manual.intro.mechanics.title') }}
          </h3>
          <p>{{ t('manual.intro.mechanics.text') }}</p>
        </div>
      </div>
    </section>

    <!-- Concepts Section -->
    <section
      class="bg-gray-900/80 backdrop-blur-md p-8 sm:p-12 rounded-3xl border border-gray-700 shadow-2xl print-page-break-after print:bg-white print:border-gray-200 print:shadow-none print:m-0 print:mb-8 portrait:rounded-none portrait:border-x-0"
    >
      <h2 class="text-3xl font-bold text-emerald-400 mb-8 flex items-center gap-3 print:text-emerald-700">
        <span class="bg-emerald-900/50 p-2 rounded-xl text-2xl print:bg-emerald-100">üí°</span>
        {{ t('manual.concepts.title') }}
      </h2>
      <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8 portrait:gap-8 portrait:divide-y-0">
        @for (
          concept of ['units', 'pest', 'rotation', 'requirements', 'weather', 'yield', 'price', 'machines'];
          track concept;
          let i = $index
        ) {
          @defer (hydrate on viewport) {
            <app-manual-concept-card [concept]="concept" [index]="i"></app-manual-concept-card>
          }
        }
      </div>
    </section>

    <!-- Crops Section -->
    <div class="flex flex-col gap-8">
      @for (crop of crops; track crop.id) {
        @defer (hydrate on viewport) {
          <app-manual-crop-card [crop]="crop"></app-manual-crop-card>
        }
      }
    </div>

    <!-- Teacher Guide Section -->
    <section
      class="bg-gray-900/80 backdrop-blur-md p-8 sm:p-12 rounded-3xl border border-gray-700 shadow-2xl print-page-break-before print:bg-white print:border-gray-200 print:shadow-none print:m-0 print:mb-8 portrait:rounded-none portrait:border-x-0"
    >
      <h2 class="text-3xl font-bold text-emerald-400 mb-8 flex items-center gap-3 print:text-emerald-700">
        <span class="bg-emerald-900/50 p-2 rounded-xl text-2xl print:bg-emerald-100">üë®‚Äçüè´</span>
        {{ t('manual.teacher.title') }}
      </h2>
      <div class="space-y-8 text-gray-300 leading-relaxed print:text-gray-700">
        <div>
          <h3 class="text-xl font-bold text-white mb-4 print:text-black">{{ t('manual.teacher.concept.title') }}</h3>
          <p>{{ t('manual.teacher.concept.text') }}</p>
        </div>
        <div class="grid md:grid-cols-2 gap-8">
          <div class="bg-gray-950/30 p-6 rounded-2xl border border-white/5">
            <h4 class="font-bold text-emerald-300 mb-2">{{ t('manual.teacher.group.title') }}</h4>
            <p class="text-sm">{{ t('manual.teacher.group.text') }}</p>
          </div>
          <div class="bg-gray-950/30 p-6 rounded-2xl border border-white/5">
            <h4 class="font-bold text-emerald-300 mb-2">{{ t('manual.teacher.discussion.title') }}</h4>
            <p class="text-sm">{{ t('manual.teacher.discussion.text') }}</p>
          </div>
        </div>
      </div>
    </section>

    <!-- References Section -->
    <section
      class="bg-gray-900/80 backdrop-blur-md p-8 sm:p-12 rounded-3xl border border-gray-700 shadow-2xl print-page-break-before print:bg-white print:border-gray-200 print:shadow-none print:m-0 print:mb-8 portrait:rounded-none portrait:border-x-0"
    >
      <h2 class="text-3xl font-bold text-emerald-400 mb-8 flex items-center gap-3 print:text-emerald-700">
        <span class="bg-emerald-900/50 p-2 rounded-xl text-2xl print:bg-emerald-100">üîó</span>
        <ng-container i18n="Heading|Title for the sources and references section@@manual.sourcesTitle">Quellen & Referenzen</ng-container>
      </h2>
      <div class="grid md:grid-cols-2 gap-12 text-sm text-gray-300 print:text-gray-700">
        <div class="space-y-4">
          <h3 class="font-bold text-white uppercase tracking-wider text-xs print:text-black" i18n="Heading|Title for stats and price sources@@manual.sourcesData">Statistiken & Preise</h3>
          <ul class="list-disc list-outside ml-5 space-y-2">
            @for (ref of agriRefs.stats; track ref.url) {
              <li>
                <a [href]="ref.url" target="_blank" class="text-emerald-400 hover:underline print:text-emerald-700">
                  {{ ref.name }}
                </a>
              </li>
            }
            @for (ref of agriRefs.prices; track ref.url) {
              <li>
                <a [href]="ref.url" target="_blank" class="text-emerald-400 hover:underline print:text-emerald-700">
                  {{ ref.name }}
                </a>
              </li>
            }
          </ul>
        </div>
        <div class="space-y-4">
          <h3 class="font-bold text-white uppercase tracking-wider text-xs print:text-black" i18n="Heading|Title for scientific background sources@@manual.sourcesScience">Wissenschaftlicher Hintergrund</h3>
          <ul class="list-disc list-outside ml-5 space-y-2">
            @for (ref of agriRefs.research; track ref.url) {
              <li>
                <a [href]="ref.url" target="_blank" class="text-emerald-400 hover:underline print:text-emerald-700">
                  {{ ref.name }}
                </a>
              </li>
            }
          </ul>
        </div>
      </div>
    </section>

    <footer class="mt-4 pt-12 border-t border-gray-800 text-center text-gray-500 text-sm print:mt-8">
      <p i18n="Footer Text|Copyright and project info@@landing.footer">¬© {{ year }} Soil Projekt. Entwickelt f√ºr Bildungszwecke.</p>
    </footer>
  </div>

  <!-- Print Settings Modal -->
  @if (showPrintModal) {
    <app-manual-print-modal
      [printSize]="printSize"
      [printOrientation]="printOrientation"
      (cancelPrint)="showPrintModal = false"
      (print)="print()"
      (sizeChange)="printSize = $event"
      (orientationChange)="printOrientation = $event"
    ></app-manual-print-modal>
  }
</div>
