<div data-testid="round-result-modal" class="fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm">
  <div class="bg-gray-900 border border-gray-700 rounded-xl shadow-2xl p-6 max-w-xl w-full relative" role="dialog" aria-modal="true" aria-labelledby="result-title">
    <h2 id="result-title" class="text-2xl font-bold text-white mb-6 font-serif text-center">Rundenergebnis</h2>

    <div class="space-y-6 max-h-[60vh] overflow-y-auto pr-2 custom-scrollbar">
      <!-- Profit -->
      <div class="flex justify-between items-center border-b border-gray-700 pb-4">
        <span class="text-gray-400">Rundengewinn</span>
        <div class="text-right">
          <span class="text-xl font-bold block" [class.text-emerald-400]="profit >= 0" [class.text-red-400]="profit < 0">
            {{ profit | currency: 'EUR' : 'symbol' : '1.0-0' }}
          </span>
          @if (subsidies > 0) {
            <span class="text-[10px] text-emerald-500 font-bold uppercase tracking-wider">
              Inkl. {{ subsidies | currency: 'EUR' : 'symbol' : '1.0-0' }} Subventionen
            </span>
          }
        </div>
      </div>

      <!-- Financial Breakdown -->
      <div class="grid grid-cols-2 gap-4 text-xs">
        <div class="bg-gray-800/30 p-2 rounded border border-gray-700/50">
          <span class="text-gray-500 block uppercase tracking-tighter">Einnahmen</span>
          <span class="text-white font-mono">{{ income + subsidies | currency: 'EUR' : 'symbol' : '1.0-0' }}</span>
        </div>
        <div class="bg-gray-800/30 p-2 rounded border border-gray-700/50">
          <span class="text-gray-500 block uppercase tracking-tighter">Ausgaben</span>
          <span class="text-white font-mono">{{ expenses | currency: 'EUR' : 'symbol' : '1.0-0' }}</span>
        </div>
      </div>

      <!-- Bio Siegel -->
      <div class="flex justify-between items-center border-b border-gray-700 pb-4">
        <div class="flex flex-col">
          <span class="text-gray-400">EU-Bio-Siegel</span>
          @if (!bioSiegel) {
            <span class="text-xs text-gray-500">Kriterien nicht erfüllt</span>
          }
          @if (bioSiegel) {
            <span class="text-xs text-emerald-500">Kriterien erfüllt!</span>
          }
        </div>

        <div [class.bg-emerald-500]="bioSiegel" [class.bg-gray-700]="!bioSiegel" class="p-2 rounded-full">
          @if (bioSiegel) {
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-6 w-6 text-white"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
            </svg>
          }
          @if (!bioSiegel) {
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-6 w-6 text-gray-400"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
          }
        </div>
      </div>

      <!-- Weather / Events -->
      <div class="bg-gray-800/50 rounded-lg p-4">
        <h3 class="text-sm font-bold text-gray-300 mb-2">Bedingungen</h3>
        <div class="flex justify-between mb-1">
          <span class="text-gray-400">Wetter</span>
          <span class="text-white">{{ t(events?.weather || 'Normal') }}</span>
        </div>
        <div class="flex justify-between">
          <span class="text-gray-400">Schädlinge</span>
          <span class="text-white">
            @if (events?.vermin?.length) {
              @for (v of events?.vermin; track v; let last = $last) {
                {{ t(v) }}{{ !last ? ', ' : '' }}
              }
            } @else {
              {{ t('None') }}
            }
          </span>
        </div>
      </div>

      <!-- Advisor (at the bottom) -->
      <app-game-advisor [currentRound]="round" [previousRound]="previousRound" [enabled]="advisorEnabled" context="result"></app-game-advisor>
    </div>

    <div class="mt-8 flex justify-center">
      <button
        (click)="onClose()"
        data-testid="close-round-result"

        class="bg-emerald-600 hover:bg-emerald-500 text-white font-bold py-3 px-8 rounded-full transition-all shadow-lg shadow-emerald-900/20"
      >
        Weiter
      </button>
    </div>
  </div>
</div>
