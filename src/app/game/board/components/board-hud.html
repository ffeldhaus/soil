<div
  class="bg-gray-900/95 border-b border-gray-700 backdrop-blur shadow-lg px-6 py-3 flex items-center justify-between shrink-0 h-16"
>
  <button
    (click)="toggleMobileMenu.emit()"
    data-testid="mobile-menu-toggle"
    class="lg:hidden p-2 hover:bg-gray-800 rounded-lg text-gray-400"
  >
    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
    </svg>
  </button>
  <!-- Left Side: Logo & Stats -->
  <div class="flex items-center gap-4">
    <h1 class="text-2xl font-bold font-serif text-emerald-500 tracking-wider hidden sm:block">SOIL</h1>
    <div class="h-6 w-px bg-gray-700 hidden sm:block"></div>
    @if (gameState) {
      <div class="flex gap-4 text-gray-200 font-mono text-sm md:text-base">
        <span class="text-yellow-400" data-testid="hud-capital">{{
          gameState.playerState?.capital ?? 0 | currency: 'EUR' : 'symbol' : '1.0-0'
        }}</span>
      </div>
    }
  </div>

  <!-- Center/Right: Desktop Controls -->
  <div class="hidden lg:flex items-center gap-3">
    <!-- User Info -->
    <div class="flex items-center gap-2 mr-2">
      @if (!isPlayer) {
        <img [src]="t('user.photoURL')" alt="Profile" class="w-6 h-6 rounded-full border border-gray-600" />
      }
      @if (user) {
        @if (!isEditingName) {
          <span
            class="text-[10px] font-bold text-gray-900 bg-gray-300 px-2 py-0.5 rounded shadow-sm border border-gray-400/50 cursor-pointer hover:bg-gray-200 transition-colors"
            (click)="startEditName(); $event.stopPropagation()"
          >
            {{
              isPlayer && !user.displayName ? playerLabel + ' ' + (playerNumber || '') : (user.displayName | uppercase)
            }}
          </span>
        } @else {
          <input
            [(ngModel)]="tempName"
            (keyup.enter)="saveName()"
            (blur)="saveName()"
            class="bg-gray-800 text-xs text-white border-b border-emerald-500 focus:outline-none w-24 px-1"
            (click)="$event.stopPropagation()"
          />
        }
      }
    </div>

    <!-- Toggle Buttons -->
    <button
      (click)="toggleLabels.emit()"
      class="px-3 py-1 font-bold text-[10px] rounded-lg border transition"
      [class.bg-emerald-600]="showLabels"
      [class.text-white]="showLabels"
      [class.border-emerald-500]="showLabels"
      [class.bg-gray-800]="!showLabels"
      [class.text-gray-400]="!showLabels"
      [class.border-gray-700]="!showLabels"
    >
      {{ t('board.nav.names') }}
    </button>
    <button
      (click)="toggleNutrition.emit()"
      class="px-3 py-1 font-bold text-[10px] rounded-lg border transition"
      [class.bg-blue-600]="showNutritionOverlay"
      [class.text-white]="showNutritionOverlay"
      [class.border-blue-500]="showNutritionOverlay"
      [class.bg-gray-800]="!showNutritionOverlay"
      [class.text-gray-400]="!showNutritionOverlay"
      [class.border-gray-700]="!showNutritionOverlay"
    >
      {{ t('board.nav.nutrition') }}
    </button>
    <button
      (click)="toggleHarvest.emit()"
      class="px-3 py-1 font-bold text-[10px] rounded-lg border transition"
      [class.bg-yellow-600]="showHarvestOverlay"
      [class.text-white]="showHarvestOverlay"
      [class.border-yellow-500]="showHarvestOverlay"
      [class.bg-gray-800]="!showHarvestOverlay"
      [class.text-gray-400]="!showHarvestOverlay"
      [class.border-gray-700]="!showHarvestOverlay"
    >
      {{ t('board.nav.harvest') }}
    </button>
    <button
      (click)="toggleSoil.emit()"
      class="px-3 py-1 font-bold text-[10px] rounded-lg border transition"
      [class.bg-emerald-700]="showSoilOverlay"
      [class.text-white]="showSoilOverlay"
      [class.border-emerald-600]="showSoilOverlay"
      [class.bg-gray-800]="!showSoilOverlay"
      [class.text-gray-400]="!showSoilOverlay"
      [class.border-gray-700]="!showSoilOverlay"
    >
      {{ t('board.nav.soil') }}
    </button>
    <button
      (click)="toggleFinance.emit()"
      [disabled]="maxRoundNumber === 0"
      class="px-3 py-1 font-bold text-[10px] rounded-lg border transition"
      [class.bg-emerald-600]="showFinance"
      [class.text-white]="showFinance"
      [class.border-emerald-500]="showFinance"
      [class.bg-gray-800]="!showFinance"
      [class.text-gray-400]="!showFinance"
      [class.border-gray-700]="!showFinance"
      [class.opacity-50]="maxRoundNumber === 0"
    >
      {{ t('board.nav.finance') }}
    </button>

    <div class="h-6 w-px bg-gray-700 mx-1"></div>

    <!-- Action Buttons -->
    <button
      (click)="openRoundSettings.emit()"
      [disabled]="isReadOnly"
      class="px-3 py-1 bg-gray-800 hover:bg-gray-700 text-gray-300 font-bold rounded-lg border border-gray-600 transition text-[10px] flex items-center gap-1 disabled:opacity-50"
    >
      {{ t('board.nav.options') }}
    </button>
    @if (gameState?.game?.status !== 'finished') {
      <button
        (click)="nextRound.emit()"
        data-testid="next-round-button"
        [disabled]="isReadOnly || isSubmitted || viewingRound < maxRoundNumber || pendingNextRound"
        class="px-3 py-1 bg-emerald-600 hover:bg-emerald-500 text-white font-bold rounded-lg border border-emerald-500 transition text-[10px] disabled:bg-gray-700 disabled:border-gray-600 disabled:text-gray-500"
      >
        @if (isSubmitted || pendingNextRound) {
          <ng-container>{{ t('board.nav.waiting') }}</ng-container>
        } @else {
          <ng-container>{{ t('board.nav.nextRound') }}</ng-container>
        }
      </button>
    }
    @if (gameState?.game?.status === 'finished') {
      <button
        (click)="showGameEnd.emit()"
        class="px-3 py-1 bg-amber-600 hover:bg-amber-500 text-white font-bold rounded-lg border border-amber-500 transition text-[10px] shadow-lg shadow-amber-900/40"
      >
        <ng-container i18n="Status Message|Indicates the game has ended@@board.nav.endGame">Spiel beendet</ng-container>
      </button>
    }
  </div>

  <div class="flex items-center gap-3">
    @defer (hydrate on interaction) {
      <app-language-switcher></app-language-switcher>
    }
    <button
      (click)="logout.emit()"
      data-testid="logout-button"
      class="p-2 hover:bg-red-900/30 rounded-lg text-red-400 hover:text-red-300 transition"
      [title]="t('board.logout')"
    >
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"
        />
      </svg>
    </button>
  </div>
</div>
